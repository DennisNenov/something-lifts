{% extends "base.html" %}
{% block title %}Program Picker{% endblock title %}
{% block headcontent %}
<!--
Temporary stylesheet before move to external.
-->

<style>
</style>

<!--
Note: move data.js to static folder later after testing is over.
Update: data.js has been moved to static folder.
-->
<script src="/static/data.js"></script>
<script>
console.log(window.data); 
data = window.data;
// Test if data was successfully / properly loaded.
</script>

<!--
This script should be moved to its own script file later and embedded when it's done.
-->

{% endblock headcontent %}

<!-- div used for displayed content to the user.
Later can be bootstrap-ified for sexiness.
-->

{% block bodycontent %}
<h1>Program Picker</h1>
<br><br>
<div id="main" class="main">
		<strong>Message:</strong><br><br>
		<div id="question" class="question">
		<!-- Write question and/or standalone response here -->
			
		</div>

		<br><br>
		<strong>Answers:</strong><br><br>
		<div id="answer_field" class="field">
		<!-- Add answer divs here. -->
		</div>
</div>


<script>
// Import a JSON file that contains question and answer nests
// in a dictionary-esque format.
// This is done by importing data.js above. 

questionDiv = document.getElementById("question");
answerFieldDiv = document.getElementById("answer_field");

// Reminder:
// Add an onClick event watcher to every answer you add.

// Necessary info should be contained within the var data.
var firstQuestion = data["Question1"];
var firstQuestionText = firstQuestion["question_text"];
questionDiv.innerHTML = firstQuestionText;

// Loop over contents of question. Search for "answer" types. 
// We should thus indicate that an entry in the JSON object is an answer type
// by prefixing its key in some way.
// This is done in the current template with "Answer#", 
// e.g. "Answer1" "Answer2" "Answer3"

var globalQuestionDiv;

var keyArray = ["Answer1", "Answer2", "Answer3"];
// Access keyArray[keyID - 1] in order to get the corresponding key in the dictionary.


for (var key in firstQuestion) {
	if (key.substring(0,1) == "A") {
		// Will use "A" as first characer as check if it's an answer type of key.
		var ansNum=key.charAt(key.length-1);

		var thisAnswer = firstQuestion[key];
		var thisAnswerText = thisAnswer["answer_text"];

		// Create an answer div
		var thisAnswerDiv = document.createElement("div");
		thisAnswerDiv.style = "answer";
		thisAnswerDiv.innerHTML = '<button id="' + ansNum + '" ' + 'class="btn btn-success">' + thisAnswerText + "</button>" + "<br><br>";

		// When an answer is clicked, the responeClick() function will be called to determine what to do.

		// Add this answer div to the answer field div
		answerFieldDiv.appendChild(thisAnswerDiv);

		console.log(thisAnswer["Message"]);
		thisMessage = thisAnswer["Message"];
		// Add on onclick eventlistener here.

		// Closure issue with JavaScript
		// Solution to implement:
		// http://stackoverflow.com/questions/750486/javascript-closure-inside-loops-simple-practical-example
		//thisAnswerDiv.addEventListener("click", function() {questionDiv.innerHTML = thisMessage;}, false);
		
		globalQuestionDiv = questionDiv; // Pass the local variable into the global 
	}
}
// In the loop above, 
// a quirky feature of JavaScript's treatment of closure
// with anonymous functions.

// Don't forget to remove the event listener.

// Hard-coding fix for above bug.

var Answer1text = firstQuestion["Answer1"]["Message"];
var Answer2text = firstQuestion["Answer2"]["Message"];
var Answer3text = firstQuestion["Answer3"]["Message"];

console.log(Answer1text);
console.log(Answer2text);
console.log(Answer3text);

console.log(document.getElementById('1'));

//document.getElementById('1').removeEventListener();
//document.getElementById('2').removeEventListener();
//document.getElementById('3').removeEventListener();

document.getElementById('1').addEventListener("click", function() {globalQuestionDiv.innerHTML = Answer1text;});
document.getElementById('2').addEventListener("click", function() {globalQuestionDiv.innerHTML = Answer2text;});
document.getElementById('3').addEventListener("click", function() {globalQuestionDiv.innerHTML = Answer3text;});

function responseClick() {
	// Determines response clicked (based on div), 
	// (signalled by onclick eventwatcher),
	// triggers loop to the end.

	// There is no need to determine if the question cycle has reached the ended of the loop,
	// by the nature of the for loop no answers will be printed.
}

// To-do: Responses, on-click event watchers, styling. 

</script>
{% endblock bodycontent %}
